From ec1c022a3c80fe9bbd6f6e254767f58ecef72730 Mon Sep 17 00:00:00 2001
From: Eugeniy Paltsev <Eugeniy.Paltsev@synopsys.com>
Date: Fri, 12 Jan 2018 13:37:55 +0300
Subject: [PATCH 60/62] ARC: HSDK: setup BOOT M_HS_CPU regiter too when setup
 AXI apertures

Signed-off-by: Eugeniy Paltsev <Eugeniy.Paltsev@synopsys.com>
---
 board/synopsys/hsdk/hsdk-cmd.c | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/board/synopsys/hsdk/hsdk-cmd.c b/board/synopsys/hsdk/hsdk-cmd.c
index 970a43a0c9..ec14e8d7d1 100644
--- a/board/synopsys/hsdk/hsdk-cmd.c
+++ b/board/synopsys/hsdk/hsdk-cmd.c
@@ -758,11 +758,21 @@ enum hsdk_axi_masters {
 #define CREG_AXI_M_OFT1(m)  ((void __iomem *)(CREG_BASE + 0x020 * (m) + 0x00C))
 #define CREG_AXI_M_UPDT(m)  ((void __iomem *)(CREG_BASE + 0x020 * (m) + 0x014))
 
+#define CREG_AXI_M_HS_CORE_BOOT	((void __iomem *)(CREG_BASE + 0x010))
+
 #define CREG_PAE	((void __iomem *)(CREG_BASE + 0x180))
 #define CREG_PAE_UPDT	((void __iomem *)(CREG_BASE + 0x194))
 
-static void init_memory_bridge(void)
+void init_memory_bridge(void)
 {
+	u32 reg;
+
+	/*
+	 * M_HS_CORE has one unic register - BOOT.
+	 * We need to clean boot mirror (BOOT[1:0]) bits in them.
+	 */
+	reg = readl(CREG_AXI_M_HS_CORE_BOOT) & (~0xFF);
+	writel(reg, CREG_AXI_M_HS_CORE_BOOT);
 	writel(0x11111111, CREG_AXI_M_SLV0(M_HS_CORE));
 	writel(0x63111111, CREG_AXI_M_SLV1(M_HS_CORE));
 	writel(0xFEDCBA98, CREG_AXI_M_OFT0(M_HS_CORE));
-- 
2.11.0

