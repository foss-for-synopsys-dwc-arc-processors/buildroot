From c1b704249ef2d58e4d20dc38adb006e802d9cc71 Mon Sep 17 00:00:00 2001
From: Eugeniy Paltsev <Eugeniy.Paltsev@synopsys.com>
Date: Sat, 9 Dec 2017 20:19:49 +0300
Subject: [PATCH 15/46] ARC: HSDK: implement callbacks to init usb and set
 clock env

Signed-off-by: Eugeniy Paltsev <Eugeniy.Paltsev@synopsys.com>
---
 board/synopsys/hsdk/hsdk.c | 16 ++++++++++++++++
 include/configs/hsdk.h     |  6 ++++++
 2 files changed, 22 insertions(+)

diff --git a/board/synopsys/hsdk/hsdk.c b/board/synopsys/hsdk/hsdk.c
index 7641978a7b..237a13316d 100644
--- a/board/synopsys/hsdk/hsdk.c
+++ b/board/synopsys/hsdk/hsdk.c
@@ -58,6 +58,22 @@ int board_mmc_init(bd_t *bis)
 	return 0;
 }
 
+int board_early_init_r(void)
+{
+	/* Init USB to be able read environment from USB MSD */
+	usb_init();
+
+	return 0;
+}
+
+int board_late_init(void)
+{
+	/* Populate environment with clock frequency values */
+	run_command("hsdk_clock get", 0);
+
+	return 0;
+}
+
 #define RESET_VECTOR_ADDR	0x0
 
 void smp_set_core_boot_addr(unsigned long addr, int corenr)
diff --git a/include/configs/hsdk.h b/include/configs/hsdk.h
index 9eacafb25f..b0323e0919 100644
--- a/include/configs/hsdk.h
+++ b/include/configs/hsdk.h
@@ -104,4 +104,10 @@
 /* Cli configuration */
 #define CONFIG_SYS_CBSIZE		2048
 
+/*
+ * Callback configuration
+ */
+#define CONFIG_BOARD_EARLY_INIT_R
+#define CONFIG_BOARD_LATE_INIT
+
 #endif /* _CONFIG_HSDK_H_ */
-- 
2.11.0

