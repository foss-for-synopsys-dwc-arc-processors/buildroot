--- sed.orig/lib/regex_internal.c	2012-12-22 17:21:52.000000000 +0400
+++ sed/lib/regex_internal.c	2016-04-27 13:55:57.704926398 +0300
@@ -974,8 +974,9 @@
 {
   set->alloc = size;
   set->nelem = 0;
-  set->elems = re_malloc (Idx, size);
-  if (BE (set->elems == NULL, 0))
+  set->elems = re_malloc (Idx, size); /* can be NULL if size == 0
+				(see re_node_set_init_empty(set)) */
+  if (BE (set->elems == NULL && size != 0, 0))
     return REG_ESPACE;
   return REG_NOERROR;
 }
